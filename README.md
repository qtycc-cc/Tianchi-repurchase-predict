# 天猫复购预测赛

## 数据来源

**一定要下载Baseline比赛的数据！！！！！！**
[Baseline比赛连接](https://tianchi.aliyun.com/competition/entrance/231576/information)

## 表结构

| 字段名称        | 描述                                             |
|-------------|------------------------------------------------|
| user_id     | 购物者的唯一ID编码                                     |
| item_id     | 商品的唯一编码                                        |
| cat_id      | 商品所属品类的唯一编码                                    |
| seller_id   | 商家的唯一ID编码                                      |
| brand_id    | 商品品牌的唯一编码                                      |
| time_stamp	 | 购买时间（格式：mmdd） 公式19 时间窗口                        |
| action_type | 包含{0, 1, 2, 3}，0表示单击，1表示添加到购物车，2表示购买，3表示添加到收藏夹 |

表1 user_log_format1 字段定义

| 字段名称      | 描述                          |
|-----------|-----------------------------|
| user_id   | 购物者的唯一ID编码                  |
| age_range | 用户年龄范围                      |
| gender    | 用户性别。0表示女性，1表示男性，2和NULL表示未知 |

表2 user_info_format1 字段定义

| 字段名称        | 描述                                          |
|-------------|---------------------------------------------|
| user_id     | 购物者的唯一ID编码                                  |
| merchant_id | 商家的唯一ID编码                                   |
| label       | 包含{0, 1}，1表示重复买家，0表示非重复买家。测试集这一部分需要预测，因此为空。 |

表3 train_format1.csv, test_format1.csv 字段定义

### 特征工程

参考链接：
[方案一](https://www.anjhon.top/compete-tianmao-repurchase-predict)
[方案二](https://tianchi.aliyun.com/forum/post/802666)

| 数据类型     | 数据字段              | 备注                                                                         |
|----------|-------------------|----------------------------------------------------------------------------|
|          | 年龄0               |                                                                            |
|          | 年龄1               |                                                                            |
|          | 年龄2               |                                                                            |
|          | 年龄3               | 1表示<18岁，2表示18-24岁，3表示25-29岁，4表示30-34岁，5表示35-39岁，6表示40-49岁，7、8表示50岁以上，0表示未知 |
|          | 年龄4               |                                                                            |
|          | 年龄5               |                                                                            |
|          | 年龄6               |                                                                            |
|          | 年龄7               |                                                                            |
|          | 年龄8               |                                                                            |
|          | 性别0               |                                                                            |
|          | 性别1               | 0表示女性，1表示男性，2表示未知                                                          |
|          | 性别2               |                                                                            |
| 用户特征     | 日志数               | 用户产生的日志量                                                                   |
 |          | 交互天数              |                                                                            |
|          | 访问商品数             |                                                                            |
|          | 访问品类数             |                                                                            |
|          | 访问品牌数             |                                                                            |
|          | 访问商家数             |                                                                            |
|          | 点击量               |                                                                            |
|          | 加购量               |                                                                            |
|          | 购买量               |                                                                            |
|          | 收藏量               |                                                                            |
|          | 偏好程度              | 加权平均(购买0.5,加购 收藏0.2,点击0.1)                                                 |
|          | 购买点击比             |                                                                            |
|          | 购买加购比             |                                                                            |
|          | 购买收藏比             |                                                                            |
|          | 购买频率              | 购买次数除以产生日志的天数                                                              |
|          | 复购率               |                                                                            |
|          | 购买商家数量            |                                                                            |
|          | 购买量与购买商家数量的比值     | 数值越大越忠诚                                                                    |
 | 商家特征     | 日志数               |                                                                            |
|          | 交互天数              |                                                                            |
|          | 被访问商品数            |                                                                            |
|          | 被访问品类数            |                                                                            |
|          | 被访问品牌数            |                                                                            |
|          | 访问用户数             |                                                                            |
|          | 点击量               |                                                                            |
|          | 加购量               |                                                                            |
|          | 购买量               |                                                                            |
|          | 收藏量               |                                                                            |
|          | 偏好程度              |                                                                            |
|          | 购买点击比             |                                                                            |
|          | 购买加购比             |                                                                            |
|          | 购买收藏比             |                                                                            |
|          | 购买频率              |                                                                            |
|          | 复购率               |                                                                            |
|          | 购买用户数量            |                                                                            |
|          | 商家卖出量与购买用户数量的比值   |                                                                            |
 | 用户商家交互特征 | 日志数               |                                                                            |
|          | 交互天数              |                                                                            |
|          | 被访问商品数            |                                                                            |
|          | 被访问品类数            |                                                                            |
|          | 被访问品牌数            |                                                                            |
|          | 点击量               |                                                                            |
|          | 加购量               |                                                                            |
|          | 购买量               |                                                                            |
|          | 收藏量               |                                                                            |
|          | 偏好程度              |                                                                            |
|          | 购买点击比             |                                                                            |
|          | 购买加购比             |                                                                            |
|          | 购买收藏比             |                                                                            |
|          | 购买频率              |                                                                            |
|          | 交互点击量占用户总点击比      | 用户对商家的操作量/用户的总操作量 反应用户对商家的操作偏好程度                                           |
|          | 交互加购量占用户总加购比      | 用户对商家的操作量/用户的总操作量 反应用户对商家的操作偏好程度                                           |
|          | 交互购买量占用户总购买比      | 用户对商家的操作量/用户的总操作量 反应用户对商家的操作偏好程度                                           |
|          | 交互收藏量占用户总收藏比      | 用户对商家的操作量/用户的总操作量 反应用户对商家的操作偏好程度                                           |
| 关键特征     | 训练集商家label平均      |                                                                            |
| 待定特征     | 商家最大平均cat_label   |                                                                            |
|          | 商家最大平均item_label  |                                                                            |
|          | 商家最大平均brand_label |                                                                            |

表4 特征表字段定义

**其中训练集拆分为两部分，一部分用作训练，一部分用作计算商家label平均，防止过拟合**

```java
// 只使用train_main部分训练
train_main, train_ratio = train_test_split(
    train,
    test_size=expose_size,
    random_state=42,
    stratify=train['label']
)

// train_ratio部分负责计算"复购率"
merchant_label_ratio = train_ratio.groupby('merchant_id')['label'].mean().reset_index().rename(
        columns={'label': 'merchant_label_ratio'})
```
